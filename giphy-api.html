<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Giphy API</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-md-8 px-2" id="button-div"></div>


      <form id="gif-form" class="col-md-4">

        <!-- Label for Text Box -->
        <div class="">
          <label class="" for="gif-input">Type here to create a new GifButton&#8482</label>

          <!-- Text Input Box -->
          <input type="text" id="gif-input">
          <br>

          <!-- Submit Button -->
          <input class="increaseSpace mb-3 mt-1" id="set-gif" type="submit" value="GIF-IFY!">
      </form>

      </div>
      <div id="button-div"></div>
      <div id="gif-div" class="col-md-12 row"></div>

    </div>
    <!-- <div id="gif-display"></div> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
      var topics = ["Rick and Morty", "Archer", "ATHF", "Futurama", "South Park", "The Simpsons", "King of the Hill",
        "Bob's Burgers", "Family Guy", "Robot Chicken"
      ];
      var buttonCount = 0;
      var inputGif = $("#gif-input").val().trim();
      var gifBox = '';

      for (var i = 0; i < topics.length; i++) {
        $("#button-div").append("<button>" + topics[i]);
        var newButton = $("<img>").attr({
          value: inputGif,
          id: "added-button-" + buttonCount,
          type: "button",
          class: "btn btn-primary"

        });
        // $(newButton).html(val);
        // $("#button-div").append(newButton + topics[i]);
      }
      // topics.observe(topics, function () {
      //   for (var i = 0; i < topics.length; i++) {
      //     $("#button-div").append("<button>" + topics[i]);
      //     var newButton = $("<input>").attr({
      //       value: inputGif,
      //       id: "added-button-" + buttonCount,
      //       type: "button",

      //     });
      //   }
      // });

      //function for api call. creates img tag and shows gif
      function searchGifs(searchTerm) {
        var queryURL = "https://api.giphy.com/v1/gifs/search?api_key=k4ZXee2WvMvmYnO7KEc0mHRSEUHV87O7&q=" +
          "$" + searchTerm + "+$random";
        console.log(queryURL);
        $.ajax({
          url: queryURL,
          method: "GET"
        }).then(function (response) {
          console.log(response);
          // gifBox = $("<embed>").attr("src", response.data.embed_url);
          $("#gif-div").empty();
          // $("#gif-div").empty();
          //how do I work through all the different data objects? it's choosing data.0 for all of the gifs.
          for (var j = 0; j < 10; j++) {
            buttonCount++;
            gifBox = $("<img>").attr({
              data: response.data[j].rating,
              id: "added-button-" + buttonCount,
              type: "button",
              class: "btn btn-primary addedGif",
              src: response.data[j].images.original_still.url,
              still: response.data[j].images.original_still.url,
              animate: response.data[j].images.original.url,
              state: "still"
            });
            newDiv = $("<div id='new-id-" + buttonCount + "' " + "class='col-md-auto addedGif'>")
            $("#gif-div").append(newDiv);
            $(newDiv).html("rating: " + response.data[j].rating + "  ");
            // console.log(repsonse.data.rating)
            $(newDiv).append(gifBox);
            // console.log(gifBox)
            // var objectVal = $(this).val();
            // $("object").text(objectVal);
            // console.log("objectVal=", objectVal);

          }
        });
      }

      function createButton() {
        buttonCount++;
        var newButton = $("<input>").attr({
          value: inputGif,
          id: "added-button-" + buttonCount,
          type: "button",

        });
        // $(newButton).html(val);
        $("#button-div").append(newButton);
      }

      //create new button when you click set-gif
      $("#set-gif").on("click", function (event) {
        event.preventDefault();
        inputGif = $("#gif-input").val();
        // createButton(inputGif);
        topics.push(inputGif);
        $("#button-div").empty();
        for (var i = 0; i < topics.length; i++) {
          $("#button-div").append("<button>" + topics[i]);
          var newButton = $("<input>").attr({
            value: inputGif,
            id: "added-button-" + buttonCount,
            type: "button",

          });
          // $(newButton).html(val);
          // $("#button-div").append(newButton + topics[i]);
        }
        $("button").addClass("btn btn-primary");

      });

      // generate gif on button click
      $("#button-div").on("click", '*', function (event) {
        event.preventDefault();
        inputGif = $(this).text();
        console.log("button div click value=", inputGif);
        searchGifs(inputGif);
      });
      $("#gif-div").on("click", '*', function () {
        console.log('test');
        var state = $(this).attr("state");
        // If the clicked image's state is still, update its src attribute to what its data-animate value is.
        // Then, set the image's data-state to animate
        // Else set src to the data-still value
        if (state === "still") {
          $(this).attr("src", $(this).attr("animate"));
          $(this).attr("state", "animate");
        } else {
          $(this).attr("src", $(this).attr("still"));
          $(this).attr("state", "still");
        }
      });
      $("button").addClass("btn btn-primary");


      // $("#added-button-" + buttonCount).append(this.val());
    </script>

</body>

</html>